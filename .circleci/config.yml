# The Firebase tools want a v6.x version of Node but Circle CI
# defaults to v4.x. Set the latest LTS version.
#

version: 2

jobs:
    build:
      docker:
        - image: circleci/node:6.11.4

# Need to tell Circle CI how to build the site
    steps:
        - checkout
        - run: JEKYLL_ENV=production bundle exec jekyll build --verbose

# Circle CI expects some kind of testing to pass in order for the
# build to be successful and deploy. Since you don't have tests
# you can fake it by just returning true. http://gph.is/1MLPDWK
    test:
      override:
        - "true"

# How you tell Circle to deploy to Firebase. The important thing to
# note here is the FIREBASE_TOKEN env variable. See below.
    deploy-job:
           docker:
             - image: of10-main-website
           working_directory: _site
           steps:
             - run:
                 name: Deploy Master to Firebase
                 command: ./node_modules/.bin/firebase deploy --token=$FIREBASE_DEPLOY_TOKEN

    workflows:
      version: 2

      -deploy:
        jobs:
          - build-job
          - deploy-job:
              requires:
                - build-job
              filters:
                branches:
                  only: master
