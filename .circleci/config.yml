# The Firebase tools want a v6.x version of Node but Circle CI
# defaults to v4.x. Set the latest LTS version.
#

version: 2

jobs:
    build:
          docker:
            - image: circleci/ruby:2.5
          environment:
            BUNDLE_PATH: ~/repo/vendor/bundle
          steps:
              - checkout
              - restore_cache:
                  keys:
                    - rubygems-v1-{{ checksum "Gemfile.lock" }}
                    - rubygems-v1-fallback
              - run:
                  name: Bundle Install
                  command: bundle check || bundle install
              - save_cache:
                  key: rubygems-v1-{{ checksum "Gemfile.lock" }}
                  paths:
                    - vendor/bundle
              - run:
                  name: Jekyll Build
                  command: JEKYLL_ENV=production bundle exec jekyll build --verbose
              - persist_to_workspace:
                  root: ./
                  paths:
                    - _site
# How you tell Circle to deploy to Firebase. The important thing to
# note here is the FIREBASE_TOKEN env variable. See below.
    deploy:
          docker:
            - image: of10-main-website
          working_directory: _site
          steps:
            - run:
                name: Deploy Master to Firebase
                command: ./node_modules/.bin/firebase deploy --token=$FIREBASE_DEPLOY_TOKEN
workflows:
    version: 2
    -deploy:
      jobs:
        - build
        - deploy:
            requires:
              - build
            filters:
              branches:
                only: develop
